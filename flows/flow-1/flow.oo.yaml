nodes:
  - node_id: +value#2
    title: "source"
    values:
      - handle: bookSource
        json_schema:
          type: string
          ui:widget: file
      - handle: prompt
        json_schema:
          type: string
          ui:widget: text
        value: ""
        description: 生成脚本内容的提示词。可以根据模版来进行修改。
        nullable: false
      - handle: imageConfig
        json_schema:
          type: object
          additionalProperties: false
          properties:
            apiEndpoint:
              enum:
                - https://ark.cn-beijing.volces.com/api/v3/images/generations
                - https://console.oomol.com/v1/images/generations
              ui:options:
                labels:
                  - DOUBAO_IMAGE_BASE_URL
                  - OOMOL_DOUBAO
            model:
              enum:
                - doubao-seedream-3-0-t2i-250415
              ui:options:
                labels:
                  - DOUBAO_SEEDREAM_T2I
            apiKey:
              contentMediaType: oomol/secret
              type: string
            size:
              enum:
                - 1024x1024
                - 720x1280
                - 1280x720
              ui:options:
                labels:
                  - 1024x1024（1:1）
                  - 720x1280（9:16）
                  - 1280x720（16:9）
        value:
          apiEndpoint: https://console.oomol.com/v1/images/generations
          model: doubao-seedream-3-0-t2i-250415
          apiKey: ${{OO_SECRET:Custom,oomol,generator}}
          size: 720x1280
      - handle: videoConfig
        json_schema:
          type: object
          additionalProperties: false
          properties:
            apiEndpoint:
              enum:
                - https://ark.cn-beijing.volces.com/api/v3
                - https://console.oomol.com/v1
              ui:options:
                labels:
                  - DOUBAO_VIDEO_BASE_URL
                  - OOMOL_DOUBAO
            model:
              enum:
                - doubao-seedance-1-0-lite-i2v-250428
              ui:options:
                labels:
                  - DOUBAO_SEEDANCE
            apiKey:
              contentMediaType: oomol/secret
              type: string
            size:
              enum:
                - 1280x720
                - 720x720
                - 720x1280
              ui:options:
                labels:
                  - 1280x720（16:9 - 720p）
                  - 720x720（1:1 - 720p）
                  - 720x1280（9:16 - 720p）
        value:
          apiEndpoint: https://console.oomol.com/v1
          model: doubao-seedance-1-0-lite-i2v-250428
          apiKey: ${{OO_SECRET:Custom,oomol,generator}}
          size: 720x1280
      - handle: audioConfig
        json_schema:
          type: object
          additionalProperties: false
          properties:
            apiEndpoint:
              enum:
                - https://cn2us02.opapi.win/v1/audio/speech
                - https://console.oomol.com/v1/audio/speech
              ui:options:
                labels:
                  - GPT_AUDIO_BASE_URL
                  - OOMOL_FUN_AUDIO_LLM
            model:
              enum:
                - tts-1
                - FunAudioLLM/CosyVoice2-0.5B
              ui:options:
                labels:
                  - GPT_TTS_1
                  - OOMOL_FUN_AUDIO_LLM
            voice:
              enum:
                - FunAudioLLM/CosyVoice2-0.5B:alex
                - alloy
                - FunAudioLLM/CosyVoice2-0.5B:anna
              ui:options:
                labels:
                  - OOMOL_FUN_AUDIO_ALEX
                  - GPT_ALLOY
                  - OOMOL_FUN_AUDIO_ANNA
            apiKey:
              contentMediaType: oomol/secret
              type: string
        value:
          apiEndpoint: https://console.oomol.com/v1/audio/speech
          model: FunAudioLLM/CosyVoice2-0.5B
          voice: FunAudioLLM/CosyVoice2-0.5B:anna
          apiKey: ${{OO_SECRET:Custom,oomol,generator}}
      - handle: outputDir
        json_schema:
          type: string
          ui:widget: dir
  - node_id: LLM#1
    title: "generateScript"
    inputs_from:
      - handle: input
        from_node:
          - node_id: +value#2
            output_handle: bookSource
      - handle: model
        value:
          model: oomol-chat
          temperature: 0
          top_p: 0.5
          max_tokens: 4096
      - handle: messages
        value:
          - role: system
            content: |-
              {{prompt}}

              请基于输入的内容{{input}}生成准确的脚本。
        schema_overrides:
          - schema:
              type: array
      - handle: prompt
        value: ""
        from_node:
          - node_id: prompt_validator#1
            output_handle: prompt
    task: llm::LLM
    ignore: false
    inputs_def:
      - handle: prompt
        json_schema:
          type: string
          ui:widget: text
        nullable: false
  - node_id: video_preview#1
    title: "Video preview #1"
    inputs_from:
      - handle: video_path
        from_node:
          - node_id: +typescript#8
            output_handle: output
    task: oomol-preview::video_preview
  - node_id: +typescript#8
    title: "extractor"
    icon: ":skill-icons:typescript:"
    task:
      ui:
        default_width: 450
      inputs_def:
        - handle: videoAsset
          json_schema:
            type: object
            additionalProperties: false
            properties:
              filePath:
                type: string
              duration:
                type: number
              resolution:
                type: string
              fileSize:
                type: number
          nullable: false
          description: Output
      outputs_def:
        - handle: output
          description: Output
          json_schema:
            type: string
      executor:
        name: nodejs
        options:
          entry: scriptlets/+scriptlet#4.ts
    inputs_from:
      - handle: videoAsset
        from_node:
          - node_id: processor#1
            output_handle: mergedVideoAsset
  - node_id: processor#1
    inputs_from:
      - handle: scenes
        from_node:
          - node_id: parse-LLM-script#1
            output_handle: scenes
      - handle: outputDir
        value: /oomol-driver/oomol-storage/output2
        from_node:
          - node_id: +value#2
            output_handle: outputDir
      - handle: audioConfig
        from_node:
          - node_id: +value#2
            output_handle: audioConfig
      - handle: imageConfig
        from_node:
          - node_id: +value#2
            output_handle: imageConfig
      - handle: videoConfig
        from_node:
          - node_id: +value#2
            output_handle: videoConfig
      - handle: sceneMetadata
        from_node:
          - node_id: parse-LLM-script#1
            output_handle: metadata
    subflow: self::processor
  - node_id: parse-LLM-script#1
    task: self::parse-LLM-script
    inputs_from:
      - handle: content
        value: null
        from_node:
          - node_id: LLM#1
            output_handle: output
    ignore: false
  - node_id: prompt_validator#1
    task: self::prompt_validator
    inputs_from:
      - handle: prompt
        value: ""
        from_node:
          - node_id: +value#2
            output_handle: prompt
title: converter
