title: "AI Video Processor"
description: "Comprehensive video processing subflow that transforms scenes into
  complete videos with AI-generated images, audio, and subtitles"
nodes:
  - node_id: +typescript#6
    title: "formatTranscript"
    icon: ":skill-icons:typescript:"
    task:
      ui:
        default_width: 450
      inputs_def:
        - handle: audioAssets
          json_schema:
            type: array
            items:
              type: object
              additionalProperties: false
          nullable: false
          description: Output
      outputs_def:
        - handle: scriptList
          json_schema:
            type: array
          nullable: true
      executor:
        name: nodejs
        options:
          entry: scriptlets/+scriptlet#5.ts
    inputs_from:
      - handle: audioAssets
        from_node:
          - node_id: generate-audio-with-ai#1
            output_handle: audioAssets
  - node_id: LLM#2
    title: "splitSentence"
    inputs_from:
      - handle: input
        value:
        from_node:
          []
      - handle: model
        value:
          model: oomol-chat
          temperature: 0
          top_p: 0.5
          max_tokens: 4096
      - handle: messages
        value:
          - role: system
            content: |-
              Split the transcript of each item in the following array by periods (.), question marks (?), and exclamation marks (!). Do not modify any text content.

              Input: {{scriptList}}

              Requirements: Only output JSON string, no other content, no code block markers, no explanations.

              Output format: [{"id":"xxx","sentences":["sentence1","sentence2"]}]
        schema_overrides:
          - schema:
              type: array
      - handle: scriptList
        from_node:
          - node_id: +typescript#6
            output_handle: scriptList
    task: llm::LLM
    inputs_def:
      - handle: scriptList
        json_schema:
          type: array
        nullable: true
    ignore: false
  - node_id: +typescript#7
    title: "parseTranscript"
    icon: ":skill-icons:typescript:"
    task:
      ui:
        default_width: 450
      inputs_def:
        - handle: audioAssets
          json_schema:
            type: array
            items:
              type: object
              additionalProperties: false
          nullable: false
          description: Output
        - handle: transcriptString
          json_schema:
            type: string
          nullable: false
      outputs_def:
        - handle: audioAssets
          json_schema:
            type: array
            items:
              type: object
              additionalProperties: false
          nullable: false
          description: Output
      executor:
        name: nodejs
        options:
          entry: scriptlets/+scriptlet#6.ts
    inputs_from:
      - handle: transcriptString
        from_node:
          - node_id: LLM#2
            output_handle: output
      - handle: audioAssets
        from_node:
          - node_id: generate-audio-with-ai#1
            output_handle: audioAssets
    ignore: false
  - node_id: +typescript#5
    title: "parseToImage"
    icon: ":skill-icons:typescript:"
    task:
      ui:
        default_width: 450
      inputs_def:
        - handle: scenes
          description: Output
          json_schema:
            type: array
            items:
              type: object
              additionalProperties: false
              properties:
                id:
                  type: string
                description:
                  type: string
                narration:
                  type: string
                visualPrompt:
                  type: string
                estimatedDuration:
                  type: number
          nullable: false
        - handle: sceneMetadata
          json_schema:
            type: object
            additionalProperties: false
            properties:
              historicalPeriod:
                type: string
              characterTraits:
                type: string
              baseImageStyle:
                type: string
          nullable: false
        - handle: imageConfig
          json_schema:
            type: object
            additionalProperties: false
            properties:
              apiEndpoint:
                enum:
                  - https://ark.cn-beijing.volces.com/api/v3/images/generations
                  - https://console.oomol.com/v1/images/generations
                ui:options:
                  labels:
                    - DOUBAO_IMAGE_BASE_URL
                    - OOMOL_DOUBAO
              model:
                enum:
                  - doubao-seedream-3-0-t2i-250415
                ui:options:
                  labels:
                    - DOUBAO_SEEDREAM_T2I
              apiKey:
                contentMediaType: oomol/secret
                type: string
              size:
                enum:
                  - 1024x1024
                  - 720x1280
                  - 1280x720
                ui:options:
                  labels:
                    - 1024x1024（1:1）
                    - 720x1280（9:16）
                    - 1280x720（16:9）
          nullable: false
      outputs_def:
        - handle: prompts
          json_schema:
            type: array
            items:
              type: object
              additionalProperties: false
              properties:
                id:
                  type: string
                content:
                  type: string
          nullable: false
          description: Output
      executor:
        name: nodejs
        options:
          entry: scriptlets/+scriptlet#7.ts
    inputs_from:
      - handle: sceneMetadata
        from_flow:
          - input_handle: sceneMetadata
      - handle: scenes
        value:
          - {}
        from_flow:
          - input_handle: scenes
      - handle: imageConfig
        from_flow:
          - input_handle: imageConfig
    ignore: false
  - node_id: +typescript#8
    title: parseToAudio
    icon: ":skill-icons:typescript:"
    inputs_from:
      - handle: scenes
        value:
          - {}
        from_flow:
          - input_handle: scenes
    task:
      ui:
        default_width: 450
      inputs_def:
        - handle: scenes
          json_schema:
            type: array
            items:
              type: object
              additionalProperties: false
              properties:
                id:
                  type: string
                description:
                  type: string
                narration:
                  type: string
                visualPrompt:
                  type: string
                estimatedDuration:
                  type: number
          nullable: false
          description: Output
      outputs_def:
        - handle: texts
          description: Output
          json_schema:
            type: array
            items:
              type: object
              additionalProperties: false
              properties:
                id:
                  type: string
                content:
                  type: string
          nullable: false
      executor:
        name: nodejs
        options:
          entry: scriptlets/+scriptlet#8.ts
          spawn: false
  - node_id: +typescript#9
    title: "parseToSubtitles"
    icon: ":skill-icons:typescript:"
    task:
      ui:
        default_width: 450
      inputs_def:
        - handle: audioAssets
          json_schema:
            type: array
            items:
              type: object
              additionalProperties: false
          nullable: false
          description: Output
      outputs_def:
        - handle: texts
          description: Output
          json_schema:
            type: array
            items:
              type: object
              additionalProperties: false
              properties:
                id:
                  type: string
                content:
                  type: string
                timing:
                  type: string
          nullable: false
      executor:
        name: nodejs
        options:
          entry: scriptlets/+scriptlet#9.ts
    inputs_from:
      - handle: audioAssets
        from_node:
          - node_id: +typescript#7
            output_handle: audioAssets
    ignore: false
  - node_id: generate-images-with-ai#1
    task: self::generate-images-with-ai
    inputs_from:
      - handle: prompts
        value:
          - {}
        from_flow:
          []
        from_node:
          - node_id: +typescript#5
            output_handle: prompts
      - handle: config
        from_flow:
          - input_handle: imageConfig
      - handle: outputDir
        value:
        from_flow:
          []
    ignore: false
  - node_id: generate-audio-with-ai#1
    task: self::generate-audio-with-ai
    inputs_from:
      - handle: outputDir
        value:
        schema_overrides:
          - schema:
              type: "null"
        from_flow:
          []
        from_node:
          []
      - handle: texts
        from_node:
          - node_id: +typescript#8
            output_handle: texts
      - handle: config
        value:
          voice: ""
        from_flow:
          - input_handle: audioConfig
    ignore: false
  - node_id: generate-subtitles-with-script#1
    task: self::generate-subtitles-with-script
    inputs_from:
      - handle: texts
        value:
          - {}
        from_flow:
          []
        from_node:
          - node_id: +typescript#9
            output_handle: texts
      - handle: outputDir
        value:
        schema_overrides:
          - schema:
              type: "null"
        from_flow:
          []
        from_node:
          []
    ignore: false
  - node_id: +typescript#2
    title: "Generate video duration list"
    icon: ":skill-icons:typescript:"
    task:
      ui:
        default_width: 450
      inputs_def:
        - handle: audioAssets
          json_schema:
            type: array
            items:
              type: object
              additionalProperties: false
          nullable: false
          description: Output
      outputs_def:
        - handle: durationList
          json_schema:
            type: array
            items:
              type: object
              additionalProperties: false
          nullable: false
          description: Output
      executor:
        name: nodejs
        options:
          entry: scriptlets/+scriptlet#1.ts
    inputs_from:
      - handle: audioAssets
        from_node:
          - node_id: generate-audio-with-ai#1
            output_handle: audioAssets
    ignore: false
  - node_id: generate-video-with-ai#1
    task: self::generate-video-with-ai
    inputs_from:
      - handle: outputDir
        value: null
        from_flow:
          []
        from_node:
          []
      - handle: config
        from_flow:
          - input_handle: videoConfig
      - handle: durationList
        from_node:
          - node_id: +typescript#2
            output_handle: durationList
      - handle: imageList
        from_node:
          - node_id: generate-images-with-ai#1
            output_handle: imageAssets
  - node_id: merge_media#1
    task: self::merge_media
    inputs_from:
      - handle: outputDir
        value: /oomol-driver/oomol-storage
        from_flow:
          - input_handle: outputDir
        from_node:
          []
      - handle: config
        from_flow:
          - input_handle: videoConfig
      - handle: subtitleAssets
        value: null
        from_node:
          - node_id: generate-subtitles-with-script#1
            output_handle: subtitleAssets
      - handle: audioAssets
        value: null
        from_node:
          - node_id: generate-audio-with-ai#1
            output_handle: audioAssets
      - handle: videoAssets
        from_node:
          - node_id: generate-video-with-ai#1
            output_handle: videoAssets
inputs_def:
  - handle: scenes
    description: "Array of scene objects containing narration, visual prompts, and
      duration data for video generation"
    json_schema:
      type: array
      items:
        type: object
        additionalProperties: false
        properties:
          id:
            type: string
          description:
            type: string
          narration:
            type: string
          visualPrompt:
            type: string
          estimatedDuration:
            type: number
    value:
      - {}
    nullable: false
  - handle: sceneMetadata
    description: "Metadata for scene generation including historical period,
      character traits, and image style preferences"
    json_schema:
      type: object
      additionalProperties: false
      properties:
        historicalPeriod:
          type: string
        characterTraits:
          type: string
        baseImageStyle:
          type: string
  - handle: imageConfig
    description: "Configuration for AI image generation including API endpoint,
      model, and output size settings"
    json_schema:
      type: object
      additionalProperties: false
      properties:
        apiEndpoint:
          enum:
            - https://ark.cn-beijing.volces.com/api/v3/images/generations
            - https://console.oomol.com/v1/images/generations
          ui:options:
            labels:
              - DOUBAO_IMAGE_BASE_URL
              - OOMOL_DOUBAO
        model:
          enum:
            - doubao-seedream-3-0-t2i-250415
          ui:options:
            labels:
              - DOUBAO_SEEDREAM_T2I
        apiKey:
          contentMediaType: oomol/secret
          type: string
        size:
          enum:
            - 1024x1024
            - 720x1280
            - 1280x720
          ui:options:
            labels:
              - 1024x1024（1:1）
              - 720x1280（9:16）
              - 1280x720（16:9）
  - handle: videoConfig
    description: "Configuration for AI video generation including API endpoint,
      model, and video resolution settings"
    json_schema:
      type: object
      additionalProperties: false
      properties:
        apiEndpoint:
          enum:
            - https://ark.cn-beijing.volces.com/api/v3
            - https://console.oomol.com/v1
          ui:options:
            labels:
              - DOUBAO_VIDEO_BASE_URL
              - OOMOL_DOUBAO
        model:
          enum:
            - doubao-seedance-1-0-lite-i2v-250428
          ui:options:
            labels:
              - DOUBAO_SEEDANCE
        apiKey:
          contentMediaType: oomol/secret
          type: string
        size:
          enum:
            - 1280x720
            - 720x720
            - 720x1280
          ui:options:
            labels:
              - 1280x720（16:9 - 720p）
              - 720x720（1:1 - 720p）
              - 720x1280（9:16 - 720p）
  - handle: audioConfig
    description: "Configuration for AI audio/speech generation including voice
      selection and API settings"
    json_schema:
      type: object
      additionalProperties: false
      properties:
        apiEndpoint:
          enum:
            - https://cn2us02.opapi.win/v1/audio/speech
            - https://console.oomol.com/v1/audio/speech
          ui:options:
            labels:
              - GPT_AUDIO_BASE_URL
              - OOMOL_FUN_AUDIO_LLM
        model:
          enum:
            - tts-1
            - FunAudioLLM/CosyVoice2-0.5B
          ui:options:
            labels:
              - GPT_TTS_1
              - OOMOL_FUN_AUDIO_LLM
        voice:
          enum:
            - FunAudioLLM/CosyVoice2-0.5B:alex
            - alloy
            - FunAudioLLM/CosyVoice2-0.5B:anna
          ui:options:
            labels:
              - OOMOL_FUN_AUDIO_ALEX
              - GPT_ALLOY
              - OOMOL_FUN_AUDIO_ANNA
        apiKey:
          contentMediaType: oomol/secret
          type: string
  - handle: outputDir
    description: "Directory path where generated video files and assets will be saved"
    json_schema:
      type: string
      ui:widget: dir
    nullable: false
outputs_def:
  - handle: mergedVideoAsset
    description: "Final merged video asset containing file path, duration,
      resolution, and size information"
    json_schema:
      type: object
      additionalProperties: false
      properties:
        filePath:
          type: string
        duration:
          type: number
        resolution:
          type: string
        fileSize:
          type: number
    nullable: false
outputs_from:
  - handle: mergedVideoAsset
    from_node:
      - node_id: merge_media#1
        output_handle: mergedVideoAsset
